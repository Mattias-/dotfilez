#!/bin/bash

if [ `whoami` != root ]; then
    echo "Please run this script using sudo"
    exit
fi

function run_as_user {
    sudo -u $SUDO_USER $@
}

update=true
install=true
python=true
ruby=true
#rails=true
haskell=true
#yesod=true
networking=true
dotfiles=true

# Settings
hostname=precise3

##############
if [ $update ] ; then
    apt-get --yes --quiet update
fi

if [ $install ] ; then
    apt-get --yes --quiet install curl git vim screen openssh-server build-essential
fi

# Dotfiles
if [ $dotfiles ] ; then
    run_as_user git clone https://github.com/Mattias-/dotfilez.git
    bash ./dotfilez/install.sh
fi

# Python
if [ $python ] ; then
    apt-get --yes --quiet install python-virtualenv python-dev pychecker
    pip install pep8 pylint pyflakes
fi

# Ruby
if [ $ruby ] || [ $rails ]; then
    if [ $rails ] ; then
        curl -L https://get.rvm.io | run_as_user bash -s stable --rails
    else
        curl -L https://get.rvm.io | run_as_user bash -s stable --ruby
    fi
fi

# Haskell
if [ $haskell ] || [ $yesod ] ; then
    apt-get --yes --quiet install haskell-platform hlint
    # Yesod
    if [ $yesod ] ; then
        run_as_user cabal update
        run_as_user echo "export PATH=\$PATH:\$HOME/.cabal/bin" >> $HOME/.bashrc
        run_as_user export PATH=$PATH:$HOME/.cabal/bin
        run_as_user cabal install yesod yesod-bin cabal-dev
    fi
fi

# Networking
if [ $networking ] ; then
    apt-get --yes --quiet install avahi-daemon
fi

# Hostname
if [ $hostname ] ; then
    echo $hostname > /etc/hostname
    sed -i "s/ubuntu/$hostname/g" /etc/hosts
    hostname $hostname
fi
