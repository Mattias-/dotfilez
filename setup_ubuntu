#!/bin/bash

if [ `whoami` != root ]; then
    echo "Please run this script using sudo"
    exit
fi

function run_as_user {
    sudo -u $SUDO_USER $@
}

update=true
install=true
python=true
haskell=true
#networking=true
#dotfiles=true
#datetime=true

# Settings
#hostname=trusty-one

##############
if [ $update ] ; then
    apt-get --yes --quiet update
    apt-get --yes --quiet upgrade
fi

if [ $install ] ; then
    apt-get --yes --quiet install curl git vim screen ntp openssh-server build-essential
fi

# Dotfiles
if [ $dotfiles ] ; then
    run_as_user git clone https://github.com/Mattias-/dotfilez.git
    bash ./dotfilez/setup_dotfiles
fi

# Python
if [ $python ] ; then
    apt-get --yes --quiet install python-dev python-pip
    pip install pep8 pylint virtualenv
fi

# Haskell
if [ $haskell ] || [ $yesod ] ; then
    apt-get --yes --quiet install haskell-platform hlint
fi

# Networking
if [ $networking ] ; then
    apt-get --yes --quiet install avahi-daemon
fi

# Hostname
if [ $hostname ] ; then
    echo $hostname > /etc/hostname
    sed -i "s/ubuntu/$hostname/g" /etc/hosts
    hostname $hostname
fi

if [ $datetime ] ; then
    echo "Europe/Stockholm" | sudo tee /etc/timezone
    dpkg-reconfigure --frontend noninteractive tzdata
fi
