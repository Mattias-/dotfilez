#!/bin/bash

if [ `whoami` != root ]; then
    echo "Please run this script using sudo"
    exit
fi

function run_as_user {
    sudo -u $SUDO_USER $@
}

update=true
install=true
python=true
ruby=true
rails=true
nodejs=true
haskell=true
yesod=true
networking=true
dotfiles=true

# Settings
hostname=precise3

##############
if [ $update ] ; then
    apt-get update -y
fi

if [ $install ] ; then
    apt-get install -y curl git vim screen openssh-server build-essential
fi

# Dotfiles
if [ $dotfiles ] ; then
    run_as_user git clone https://github.com/Mattias-/dotfilez.git
    bash ./dotfilez/install.sh
fi

# Python
if [ $python ] ; then
    apt-get install -y python-virtualenv python-dev pychecker
    pip install pep8 pylint pyflakes
fi

# Ruby
if [ $ruby ] || [ $rails ]; then
    run_as_user curl -L https://get.rvm.io | bash -s stable
    run_as_user source ~/.rvm/scripts/rvm
    run_as_user rvm requirements
    run_as_user rvm install ruby
    run_as_user rvm use ruby --default
    run_as_user rvm rubygems current
    # Rails
    if [ $rails ] ; then
        run_as_user gem install rails
    fi
fi


# Nodejs
#TODO

# Haskell
if [ $haskell ] || [ $yesod ] ; then
    apt-get install -y haskell-platform hlint
    # Yesod
    if [ $yesod ] ; then
        run_as_user cabal update
        run_as_user echo "export PATH=\$PATH:\$HOME/.cabal/bin" >> $HOME/.bashrc
        run_as_user export PATH=$PATH:$HOME/.cabal/bin
        run_as_user cabal install yesod yesod-bin cabal-dev
    fi
fi

# Networking
if [ $networking ] ; then
    apt-get install -y avahi-daemon
fi

# Hostname
if [ $hostname ] ; then
    echo $hostname > /etc/hostname
    sed -i "s/ubuntu/$hostname/g" /etc/hosts
    hostname $hostname
fi
