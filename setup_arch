#!/bin/bash
set -euo pipefail

mkdir -p ~/screenshots

sudo timedatectl set-ntp true

sudo pacman -Syu
sudo pacman -S --needed \
    curl \
    jq \
    git \
    vim \
    bc \
    go \
    hub \
    keepassxc \
    htop \
    shellcheck \
    traceroute \
    nmap \
    tree \
    tmux \
    ufw \
    openssh \
    iperf3 \
    neovim \
    terraform \
    vagrant \
    packer \
    alacritty \
    docker \
    virtualbox \
    virtualbox-host-modules-arch \
    fzf \
    rclone \
    the_silver_searcher \
    shfmt \
    python \
    python-pip \
    python-pipenv \
    python2 \
    xorg-server-xwayland \
    sway \
    swayidle \
    swaylock \
    grim \
    slurp \
    wl-clipboard \
    ttf-inconsolata \
    ttf-dejavu \
    ttf-liberation \
    ttf-roboto \
    dmenu \
    pavucontrol \
    grc \
    light \
    pulseaudio \
    bash-completion \
    unzip \
    waybar \
    noto-fonts-emoji

sudo usermod -aG docker "$USER"

# Install yay
if ! yay -V &>/dev/null; then
    git clone https://aur.archlinux.org/yay.git "$HOME/projects/yay"
    cd "$_"
    makepkg -si --noconfirm
fi

yay -S \
    yay \
    google-chrome \
    google-cloud-sdk \
    kubernetes-helm-bin \
    kubectl-bin \
    minikube-bin \
    spotify \
    cfssl \
    ttf-font-awesome-4 \
    kind-bin

pip3 install --user --upgrade \
    neovim \
    black \
    yamllint \
    awscli

sudo usermod -aG video "$USER"

# Add udev rule for light command
sudo tee /usr/lib/udev/rules.d/90-backlight.rules <<EOF
ACTION=="add", SUBSYSTEM=="backlight", RUN+="/bin/chgrp video /sys/class/backlight/%k/brightness"
ACTION=="add", SUBSYSTEM=="backlight", RUN+="/bin/chmod g+w /sys/class/backlight/%k/brightness"
ACTION=="add", SUBSYSTEM=="leds", RUN+="/bin/chgrp video /sys/class/leds/%k/brightness"
ACTION=="add", SUBSYSTEM=="leds", RUN+="/bin/chmod g+w /sys/class/leds/%k/brightness"
EOF

install_assume_role() {
    sudo curl -Lso /usr/local/bin/assume-role https://raw.githubusercontent.com/coinbase/assume-role/master/assume-role
    sudo chmod +x /usr/local/bin/assume-role
}
#install_assume_role
